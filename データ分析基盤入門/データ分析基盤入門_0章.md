---
marp: true
---

# 0-1.データ分析基盤とサービスの提供先

- データ分析基盤のサービス提供先を3つのシステム（SoR、SoI、SoE）に分類
- これらのシステム間の関係性について説明
- データ分析基盤の人（組織）への貢献について紹介

---

## ★システムの3分類
### SoR（System of Records）
- 組織の基幹となるデータを管理するシステム
- 労務管理や受注管理などトランザクションデータ

### SoE（System of Engagement）
- 組織と顧客との接点を管理するシステム
- CRMツールなどがこれに該当（顧客の閲覧履歴や購入履歴）
 
### SoI（System of Insight/System of Intelligence）
- データを活用して新たな価値を生み出すシステム
- 本テーマの中心となる**データ分析基盤**はこのSoIに分類される

---

![bg contain](./figure/システムの3分類.png)




---

## ★データ活用のエコシステムを構成する6つのプロセス

1. **データの取り込み（コレクティングレイヤー）**：データソースからデータを収集
2. **データの処理（プロセシングレイヤー）**：データの処理
3. **データの保存（ストレージレイヤー）**：データを適切な形式で保存
4. **データの提供（アクセスレイヤー）**：分析結果を必要な形で参照
5. **価値の利用**：分析結果から具体的なアクションを起こす
6. **データの循環**：新たに生成されたデータを再度分析基盤に取り込み循環利用

---
## ★「データを活用する」とは？

**BIツールでデータを可視化する**だけではなく、

- データ分析基盤からデータを提供して活用する
- データのガバナンスを整理する（たとえば、バラバラな指標を整理して統一化するなど）

などの、より広範な活動を含んでいる。

このような包括的な理解が、効果的なデータ分析基盤の構築と運用には不可欠！

---

![bg contain](./figure/データ活用サイクル.png)

---

# 0-2.データ分析基盤と周辺技術 
## データ開発以外でも利用するツールも活躍

- データ分析基盤と周辺技術のデータベース/ストレージ、APIについて説明
- データ分析基盤でのストレージとデータベースの使用方法を解説
- データ分析基盤のAPIの基本的な仕組みを紹介
- これらは一般的な技術なので、普段の業務経験と関連付けて理解できる

---
# ★オブジェクトストレージ
## データをオブジェクトという単位で管理

- 各オブジェクトには、データ本体に加えて**メタデータ**（作成日時、タグなど）が付与され、一意のIDで管理される
- 階層構造を持たず、大量のデータを効率的に管理可能
- 容量を必要に応じて柔軟に拡張できる
- RESTful APIを通じてデータにアクセスできるため、クラウドサービスとの親和性が高い
- 主にローデータ（未加工データ）や加工後のデータを格納

例：Amazon S3、Google Cloud Storage、Microsoft Azure Blob Storageなど

---

# ★RDB（リレーショナルデータベース）
## 「表（テーブル）」としてデータを管理

- データはテーブル（表）として構造化　行（レコード）と列（カラム）で構成
- RDBはExcelに似ているが...
    - RDBはExcelよりも高度な機能を持つ
    - 大量のデータを安全に管理可能
    - 複数のユーザーが同時にアクセスできる仕組みを備える
- RDBから必要なデータを抽出（Extract）し、加工（Transform）して、保存場所に移動（Load）するETLという作業が重要
- RDBの知識（SQLやトランザクション処理など）は、データサイエンティストの基礎スキルとして重要

---

# ★KVS（キーバリューストア）
## キーとバリューの組み合わせでデータを管理
- データ同士の関係性（リレーション）を持たせず、シンプルにデータを保存
- 高速なデータの読み書きが可能
- 複数のサーバー（ノード）でデータを分散して保存可能
- スケールアウト（データ量の増加に応じてシステムを拡張）が容易
- ドキュメント型（JSONタイプ）がデータ分析の現場でよく使用される
- 分析後のデータを格納しweb APIのバックエンドとして利用するケースが多い


---

## ★KVSのタイプと製品例
- **ドキュメント型**：JSON形式のような構造化されたデータを保存できるタイプ
    - 柔軟なデータ構造、検索性能が高い
    - 例：MongoDB, Amazon DocumentDB, Couchbase
- **キーバリュー型**：最もシンプルな形式で、キーに対して単純な値を保存
    - シンプルで高速、キャッシュに適している
    - 例：Redis, Amazon DynamoDB, Apache Cassandra


---

- **グラフ型**：データ間の関係性（つながり）を重視して保存
    - 関係性の分析が得意、複雑なつながりの探索が可能
    - 例：Neo4j, Amazon Neptune
- **カラム指向型**：データを列（カラム）単位で保存
    - 特定のカラムに対する集計処理が高速
    - 例：Apache HBase, Apache Cassandra

---

![bg contain](./figure/KVSの種類と概要.png)

---

# ★Web API
## システム間の通信を行うための標準的なインターフェース

- 決められた形式で**リクエスト**を送り、サービス側から**レスポンス**を受け取る
- データ分析基盤では、分析用データの取得、メタデータの参照、分析処理の実行指示などで活用される
- Web APIを使用する利点 
    - システム同士を疎結合に保つ
        - システム変更時もAPI仕様を維持すれば他のシステムに影響を与えない
        - 新しいAPIエンドポイントを追加するだけで機能追加可能
    - 様々な種類のクライアントから統一的な方法でサービスにアクセス可能
    - APIを介してアクセスを制御することで、システムの内部実装を外部から隠蔽

---

![bg contain](./figure/APIの利点と用途.png)

---

![bg contain](./figure/データ基盤のためのストレージとインタフェース.png)

---


# 0-3. データ分析基盤と外部との接点を理解しよう 
## データ分析基盤もユーザー接点が大事

- データ分析基盤がSoR/SoEシステムに提供する2つの主要な価値について説明
    - データの可視化
    - 外部への付加価値の提供

---

# ★データの可視化
## 膨大なデータを表やグラフ、画像で理解しやすく表現


1. コレクティングレイヤーで社内外のデータを収集
    - 業務提携先のデータ、サードパーティデータ、政府のオープンデータなど
2. プロセシングレイヤーでデータを統合し、扱いやすい形に整理
3. ストレージレイヤーでS3などの分析向けストレージにデータを保存
4. アクセスレイヤーでBIツールを使用してサービスや事業の傾向を可視化
5. 可視化結果をもとにプロダクトや組織の改善施策を実施
6. 改善施策の効果を確認するために必要なデータを再度収集（ステップ1に戻る）。


本来の目的である、「改善活動」につながるよう、
**可視化の目的を明確にしてから企画・設計を始めることが重要**

---
# 外部への付加価値の提供　
## データをアプリケーションと連携していこう

- データ分析基盤における外部への付加価値提供
    - 集まったデータを可視化
    - データに付加価値をつけて外部へ提供する
- データ活用プロセス
    - コレクティングレイヤー：社内外のデータを収集
    - プロセシングレイヤー：モデルを適用して目的の値を算出
    - ストレージレイヤー：データベースとオブジェクトストレージの両方にデータを保存
    - アクセスレイヤー：APIを通じてデータを取得・利用

---

![bg contain](./figure/データ活用サイクル.png)

---

# 多様なデータを収集し、より詳細な分析を行う

- ログの種類
    - クリックログ：ユーザーがどのボタンをクリックしたかというログ
    - 広告表示ログ：どの広告が表示されたかを記録するログ

- 長期保存に適したオブジェクトストレージを活用

- フィードバックループ：データから得られた気づきや知見を実際のサービス改善に活かし、その結果また新しいデータが集まる、という循環のこと

データ活用の成功のポイントは、データを集めて分析するだけでなく、その結果を実際のサービス改善に活かし、**継続的な改善サイクルを作ること**

---

![bg contain](./figure/データ活用サイクル.png)

---
# データの外部提供方法

- リバースETL：分析基盤のデータを他のシステムに送り返す方法
- フロントアプリでの表示：Webサイトやスマートフォンアプリなどでデータを直接表示する方法（これを「組み込みBI」とも呼ぶ）
- ファイル連携：CSVなどのファイル形式でデータを共有する方法
- ヘッドレスBI：APIを通じてデータを提供し、他のシステムが自由に活用できるようにする方法


- これらの提供方法は異なって見えますが、基本的な考え方は共通している
    - データを収集する → 必要な形に加工する → 使いやすい形で外部に提供する → フィードバックを得て改善する

---

![bg contain](./figure/効率的なデータの外部提供.png)

---

# 0-4.データ分析基盤開発とサポートツール 
## データ開発以外でも利用するツールも活躍

- データ分析基盤の開発は、他のシステム開発と基本的な考え方は同じ
- データ分析基盤の開発手法と、それをサポートする開発ツールについて説明
- 説明にあたっては、一般的なシステム開発との共通点に焦点を当てる

---

# ★単体テスト　
## テストの基本はデータ分析基盤も同じ

- PySparksはデータ分析基盤でよく使用される分散処理フレームワーク
    - データフレームという形式でデータの変換や処理を行う
- 一般的なシステム開発と同様に単体テスト（ユニットテスト）が重要
    - これにはPytestなどの標準的なテストライブラリが利用可能
- プログラムのテストだけでなく、データ自体の品質をテストする必要がある
    - これについては第7章で詳しく説明

--- 
# テスト対象 target.py

```
from pyspark.sql import functions as F 

 # pyspark関数
 def age(birth_year_col: str, birth_month_col: str):
     return (
             F.year(F.current_date())
             - F.col(birth_year_col)
             - F.when(F.month(F.current_date()) < F.col(birth_month_col), 1).otherwise（0）
             ).cast("int")


```
- PySpark SQLの関数（Functions as F）を使用して、生年月日から年齢を計算する共通関数「age」を定義
- この関数は、現在の日付と生年月日を比較して正確な年齢を計算する

---

# テストコード（test/target.py）

- テストデータを含むデータフレームの作成
- target.pyのage関数を呼び出して結果を取得
- 計算結果と期待値の比較による検証

---

# ★CI/CD（継続的インテグレーション/継続的デプロイメント）
## 自動化してデータとシステムの品質を上げよう

- システム開発においてテストやデプロイ作業を自動化し、継続的に実行する手法
- 手動での確認作業による時間のロスやミスを防ぐ
- CI/CDパイプライン
    - PyTestを使用したテストの自動実行（CI）
    - テストが成功した場合のみ、プログラムが自動的にデプロイ（CD）される仕組みを構築
- データ品質のテストもCI/CDパイプラインに組みこみ継続的に評価
- 特定の状況においては、手動でのチェックリストによる確認も有効な方法

--- 

![bg contain](./figure/CI_CDプロセスの自動化.png)

---

# ★コマンドライン (CLI)

- データ分析基盤でのCLIの主な活用場面
    - データの取得 
    - データ転送
    - システムの運用管理
    - データの正確性確保のための作業
- CLI関連技術
    - grepなどの検索コマンド
    - AWKなどのテキスト処理ツール
    - シェルスクリプトによる自動化

**使用しているサービスやツールでCLI操作が可能かまず確認する**

---

# ★監視/運用　
## 監視対象を決め継続的に状況を可視化し対策する

- 一般的なシステム監視項目に加えて、データ品質についても継続的な確認が必要
- 運用監視の具体的な設定項目
    - データ品質のテスト項目
    - SLO（Service Level Objective：サービスレベル目標）
        - システムやサービスが達成すべき具体的な性能目標値
        - 例：データ処理の遅延を5分以内に抑えるなど
    - KPI（Key Performance Indicator：重要業績評価指標）
        - ビジネスや業務の成果を測定するための重要な指標
        - 例：ユーザーからのクエリ応答時間、データ更新の頻度など

---

![bg contain](./figure/システム運用と監視のための指標.png)

